<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Word Wheel 8-Slot Edition</title>
    <style>
        :root {
            --black: #000000; --white: #ffffff; --purple: #3d1f6e;
            --orange: #f2631a; --blue: #54baf7; --yellow: #ffd447;
            --grey: #e0e0e0; --green: #DDEDAA; --dark-green: #7fb36d;
        }

        * { -webkit-tap-highlight-color: transparent; touch-action: manipulation; box-sizing: border-box; }
        
        body {
            margin: 0; padding: 10px; width: 100%;
            background-color: var(--orange); font-family: system-ui, sans-serif;
            display: flex; flex-direction: column; align-items: center; min-height: 100vh;
        }

        .game-card {
            background: var(--white); padding: 15px; border-radius: 25px;
            box-shadow: 0px 10px 30px rgba(0,0,0,0.3);
            width: 100%; max-width: 500px; text-align: center;
        }

        .stats { display: flex; justify-content: space-between; font-weight: 800; margin-bottom: 10px; color: var(--purple); font-size: 0.8rem; }

        /* Wheel Container with 3D fade effect */
        .wheel-box {
            display: flex; justify-content: center; gap: 4px; 
            height: 240px; overflow: hidden; background: #f8f8f8;
            border-radius: 15px; padding: 10px; position: relative;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.1);
        }

        .wheel-box::before, .wheel-box::after {
            content: ""; position: absolute; left: 0; right: 0; height: 40px; z-index: 5; pointer-events: none;
        }
        .wheel-box::before { top: 0; background: linear-gradient(to bottom, #f8f8f8, transparent); }
        .wheel-box::after { bottom: 0; background: linear-gradient(to top, #f8f8f8, transparent); }

        .column { display: flex; flex-direction: column; gap: 6px; }
        
        .cell {
            width: clamp(32px, 10vw, 55px); height: 40px; 
            display: flex; align-items: center; justify-content: center;
            font-size: 1rem; font-weight: 900; background: white; 
            border-radius: 6px; border: 1px dashed var(--grey); color: #ccc;
            transition: transform 0.1s;
        }

        .cell.active-row {
            height: 55px; width: clamp(38px, 12vw, 65px);
            font-size: 1.6rem; border: 3px solid var(--purple); color: var(--purple);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .cell.correct { background-color: var(--green) !important; border-color: var(--dark-green) !important; color: var(--purple) !important; }

        /* Compact Arrow Controls */
        .control-group { display: flex; flex-direction: column; gap: 4px; flex: 1; }
        .arrow-btn {
            height: 35px; background: var(--grey); border: 2px solid var(--black);
            border-radius: 8px; font-weight: 900; cursor: pointer;
            box-shadow: 0 2px 0 var(--black); font-size: 0.8rem;
        }
        .arrow-btn:active { transform: translateY(2px); box-shadow: none; }

        .game-btn {
            padding: 12px; border-radius: 12px; border: 3px solid var(--black);
            font-weight: 900; cursor: pointer; text-transform: uppercase;
            box-shadow: 0 4px 0 var(--black); flex: 1; font-size: 0.8rem;
        }

        #clue-text { font-size: 0.8rem; color: var(--purple); margin: 12px 0; min-height: 35px; line-height: 1.3; }
    </style>
</head>
<body>

    <div class="game-card">
        <div id="splash">
            <h1 style="color:var(--purple); margin-bottom:10px;">WORD WHEEL</h1>
            <p id="final-msg" style="font-weight:bold;"></p>
            <button class="game-btn" style="background:var(--yellow); width: 100%;" onclick="start()">START GAME</button>
        </div>

        <div id="game-area" style="display:none;">
            <div class="stats">
                <span>LEVEL <span id="lvl">1</span></span>
                <span>STREAK: <span id="streak">0</span></span>
            </div>

            <div class="wheel-box" id="display"></div>
            
            <div id="controls-container" style="display: flex; gap: 4px; margin-bottom: 15px;"></div>

            <div id="clue-text">Tap CLUE for a definition</div>

            <div style="display: grid; gap: 8px;">
                <div style="display: flex; gap: 8px;">
                    <button class="game-btn" style="background:var(--blue); color:white;" onclick="check()">SUBMIT</button>
                    <button class="game-btn" style="background:var(--yellow);" onclick="getClue()">CLUE</button>
                </div>
                <div style="display: flex; gap: 8px;">
                    <button class="game-btn" style="background:var(--orange); color:white;" onclick="shuffle()">SHUFFLE</button>
                    <button class="game-btn" style="background:var(--white); color: #888;" onclick="revealAnswer()">REVEAL</button>
                </div>
            </div>
        </div>
    </div>

<script>
    let wheels = [], targets = [], currentLevel = 1, wordLength = 2, streak = 0, clues = [];
    const alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";

    async function fetchLevelData(len) {
        try {
            const res = await fetch(`https://api.datamuse.com/words?sp=${'?'.repeat(len)}&md=d&max=80`);
            const data = await res.json();
            const valid = data.filter(w => w.defs && w.defs.length > 0 && /^[a-z]+$/.test(w.word));
            const pick1 = valid[Math.floor(Math.random() * valid.length)];
            let pick2 = valid[Math.floor(Math.random() * valid.length)];
            while(pick2.word === pick1.word) pick2 = valid[Math.floor(Math.random() * valid.length)];
            targets = [pick1.word.toUpperCase(), pick2.word.toUpperCase()];
            clues = [pick1.defs[0].split('\t')[1], pick2.defs[0].split('\t')[1]];
        } catch (e) {
            targets = [len === 2 ? "HE" : "CAT", len === 2 ? "IT" : "DOG"];
            clues = ["Male person", "Generic object"];
        }
    }

    async function start() {
        streak = 0; currentLevel = 1; wordLength = 2;
        document.getElementById('splash').style.display = 'none';
        document.getElementById('game-area').style.display = 'block';
        await setupLevel();
    }

    async function setupLevel() {
        await fetchLevelData(wordLength);
        document.getElementById('lvl').innerText = currentLevel;
        document.getElementById('streak').innerText = streak;
        document.getElementById('clue-text').innerText = "Tap CLUE for a definition";
        
        const display = document.getElementById('display');
        const ctrlContainer = document.getElementById('controls-container');
        display.innerHTML = ctrlContainer.innerHTML = "";

        for(let i=0; i<wordLength; i++) {
            // Setup wheel with 8 letters (2 targets + 6 random)
            let chars = [targets[0][i], targets[1][i]];
            while(chars.length < 8) {
                let r = alphabet[Math.floor(Math.random()*26)];
                if(!chars.includes(r)) chars.push(r);
            }
            chars.sort(() => Math.random() - 0.5);
            wheels[i] = chars;

            const col = document.createElement('div');
            col.className = 'column'; col.id = `col-${i}`;
            display.appendChild(col);

            const group = document.createElement('div');
            group.className = 'control-group';
            
            const upBtn = document.createElement('button');
            upBtn.className = 'arrow-btn'; upBtn.innerText = "â–²";
            upBtn.onclick = () => spin(i, -1);
            
            const downBtn = document.createElement('button');
            downBtn.className = 'arrow-btn'; downBtn.innerText = "â–¼";
            downBtn.onclick = () => spin(i, 1);
            
            group.appendChild(upBtn);
            group.appendChild(downBtn);
            ctrlContainer.appendChild(group);

            draw(i);
        }
    }

    function draw(i) {
        const col = document.getElementById(`col-${i}`);
        col.innerHTML = "";
        // Draw 5 rows: Row 0 and 1 are the active ones
        // Index 7 (prev), 0 (Active1), 1 (Active2), 2 (next)
        [7, 0, 1, 2].forEach((idx, pos) => {
            const cell = document.createElement('div');
            cell.className = 'cell' + (pos === 1 || pos === 2 ? ' active-row' : '');
            cell.innerText = wheels[i][idx % 8];
            col.appendChild(cell);
        });
    }

    function spin(i, dir) {
        if(dir === 1) wheels[i].unshift(wheels[i].pop());
        else wheels[i].push(wheels[i].shift());
        draw(i);
    }

    function getClue() {
        document.getElementById('clue-text').innerText = `1: ${clues[0]} \n 2: ${clues[1]}`;
    }

    function check() {
        let w1 = "", w2 = "";
        for(let i=0; i<wordLength; i++) { w1 += wheels[i][0]; w2 += wheels[i][1]; }
        
        if(w1 === targets[0] && w2 === targets[1]) {
            document.querySelectorAll('.active-row').forEach(el => el.classList.add('correct'));
            streak++;
            setTimeout(async () => {
                if(wordLength < 6) {
                    currentLevel++; wordLength++; await setupLevel();
                } else {
                    document.getElementById('game-area').style.display = 'none';
                    document.getElementById('splash').style.display = 'block';
                    document.getElementById('final-msg').innerText = "ðŸ† MASTER UNLOCKED! STREAK: " + streak;
                }
            }, 1000);
        }
    }

    function shuffle() {
        for(let i=0; i<wordLength; i++) {
            let r = Math.floor(Math.random() * 8);
            for(let j=0; j<r; j++) spin(i, 1);
        }
    }

    function revealAnswer() {
        streak = 0;
        document.getElementById('streak').innerText = streak;
        for(let i=0; i<wordLength; i++) {
            while(wheels[i][0] !== targets[0][i] || wheels[i][1] !== targets[1][i]) {
                spin(i, 1);
            }
        }
    }
</script>
</body>
</html>
